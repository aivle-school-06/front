
openapi: 3.0.1
info:
  title: SENTINEL PoC API
  version: 1.1.0
  description: >
    SENTINEL is a corporate risk monitoring and early-warning platform.
    This API is designed around risk status distribution monitoring and
    metric-based forecasting, not partner performance tracking or single
    health-score prediction.

servers:
  - url: https://api.sentinel.local

tags:
  - name: Dashboard
    description: Aggregated risk monitoring dashboard
  - name: Companies
    description: Company search, registration, and risk analysis
  - name: UpdateRequests
    description: User-to-admin update request handling

paths:

  /dashboard/summary:
    get:
      tags: [Dashboard]
      summary: Risk status distribution dashboard
      description: >
        Returns aggregated dashboard data including current risk status
        distribution and its change over time (NORMAL / CAUTION / RISK).
        This endpoint does NOT represent partner performance trends.
      responses:
        '200':
          description: Dashboard summary response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardSummary'

  /companies/search:
    get:
      tags: [Companies]
      summary: Search companies
      description: Search companies by name or company code.
      parameters:
        - in: query
          name: name
          schema:
            type: string
        - in: query
          name: code
          schema:
            type: string
      responses:
        '200':
          description: Company search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CompanySearchItem'

  /companies/confirm:
    post:
      tags: [Companies]
      summary: Confirm company registration
      description: >
        Confirms a company for monitoring.
        If existing model results are found, cached results are reused.
        Otherwise, a new risk analysis process is triggered.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                companyId:
                  type: string
              required: [companyId]
      responses:
        '200':
          description: Existing or completed analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyConfirmResponse'
        '202':
          description: Analysis in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyConfirmResponse'

  /companies/{companyId}/overview:
    get:
      tags: [Companies]
      summary: Company risk overview
      description: >
        Returns a comprehensive risk overview for a company.
        Includes metric-based forecasts, current risk indicators,
        and AI-generated commentary.
        This endpoint does NOT return a single health-score forecast.
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Company overview response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyOverview'

  /companies/{companyId}/update-requests:
    post:
      tags: [UpdateRequests]
      summary: Create update request
      description: Sends an update request for a company to the administrator.
      parameters:
        - in: path
          name: companyId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequestCreate'
      responses:
        '201':
          description: Update request created successfully

components:
  schemas:

    CompanySearchItem:
      type: object
      properties:
        companyId:
          type: string
        companyName:
          type: string
        industry:
          type: string

    CompanyConfirmResponse:
      type: object
      properties:
        status:
          type: string
          enum: [EXISTING, PROCESSING, COMPLETED]
        companyId:
          type: string

    DashboardSummary:
      type: object
      description: >
        Aggregated dashboard data focused on company risk status.
      properties:
        riskStatusDistribution:
          type: object
          description: Current distribution of companies by risk status
          properties:
            NORMAL:
              type: integer
            CAUTION:
              type: integer
            RISK:
              type: integer
        riskStatusDistributionTrend:
          type: array
          description: Change in risk status distribution over time
          items:
            type: object
            properties:
              date:
                type: string
              NORMAL:
                type: integer
              CAUTION:
                type: integer
              RISK:
                type: integer

    CompanyOverview:
      type: object
      description: >
        Company risk overview based on multiple financial and risk indicators.
        Forecasts are provided per metric, not as a single health score.
      properties:
        metricForecasts:
          type: array
          description: Forecasted values for key metrics
          items:
            $ref: '#/components/schemas/MetricForecast'
        keyIndicators:
          type: array
          description: Current key risk indicators
          items:
            $ref: '#/components/schemas/IndicatorItem'
        aiCommentary:
          type: string

    MetricForecast:
      type: object
      properties:
        metricName:
          type: string
          example: ROA
        timeline:
          type: array
          description: Past, current, and next-quarter values
          items:
            type: object
            properties:
              period:
                type: string
                example: 2024Q4
              value:
                type: number

    IndicatorItem:
      type: object
      properties:
        name:
          type: string
        value:
          type: number
        status:
          type: string
          enum: [NORMAL, CAUTION, RISK]

    UpdateRequestCreate:
      type: object
      properties:
        message:
          type: string
